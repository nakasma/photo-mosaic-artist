# Photo Mosaic Artist

**Photo Mosaic Artist** は、ブラウザ上で動作する高機能なフォトモザイクアート生成アプリケーションです。

サーバーへの画像アップロードを行わず、すべての処理をクライアントサイド（ブラウザ）の JavaScript で完結させるため、プライバシーを守りながら高速にアートを生成できます。人間の視覚特性に近い「CIELAB色空間」を使用した高精度な色マッチングアルゴリズムにより、自然で美しいモザイク画を作成します。

## ✨ 主な機能

* **完全クライアントサイド処理**: 画像データを外部サーバーに送信しないため、プライバシーやセキュリティ面で安心です。
* **高度な色マッチング**: 単純なRGB比較ではなく、人間の知覚に近い「CIELAB色空間」と「Delta E (dE76)」距離計算を用い、最適なタイル画像を自動選定します。
* **スマートな画像解析**:
* **Center-Weighted Average**: タイル画像の平均色を算出する際、中心部分の重みを大きくすることで、被写体の特徴をより正確に捉えます。
* **多様性維持アルゴリズム**: 同じ画像が隣接したり、頻繁に使用されすぎないようにペナルティを与えるロジックを搭載しています。


* **インタラクティブなプレビュー**: 生成された巨大なモザイク画を、Google Mapsのようにドラッグ（パン）やズーム操作で細部まで確認できます。
* **カスタマイズ設定**:
* **画質設定**: スマホ向けの軽量設定から、PC向けの4K超え高画質出力まで選択可能。
* **モザイク密度**: 20〜150分割の間で解像度を調整可能。
* **ブレンド率**: 元画像を薄く重ねることで、タイルの数が少なくても輪郭をはっきりさせる機能（0〜80%）。
* **色調補正**: タイルの色を元画像に合わせて自動で微調整する機能。



## 🚀 使い方

1. **メイン写真の選択 (Step 1)**
* モザイクアートの全体像となるベース画像をドラッグ＆ドロップ、またはクリックして選択します。


2. **ピース写真の追加 (Step 2)**
* モザイクの「点」となる画像を大量に追加します（数百枚以上推奨）。
* **画質設定**: 画像を追加する前に「軽量(100px)」「標準(300px)」「高画質」から選択できます。
* フォルダごとのドラッグ＆ドロップにも対応しています。解析は非同期で行われ、プログレスバーで進捗が表示されます。


3. **生成設定 (Step 3)**
* **モザイクの密度**: 細かくするほど時間はかかりますが、精細な画像になります（最大150分割）。
* **ブレンド率**: 10〜20%程度に設定すると、全体像がより鮮明になります。
* **モザイクアート生成ボタン**をクリックして生成を開始します。


4. **保存**
* 生成完了後、プレビュー画面で仕上がりを確認し、「画像を保存」ボタンでPNG形式としてダウンロードします。ファイル名は `YYYYMMDD_mosaic_art.png` 形式で保存されます。



## 🛠 技術スタック

このアプリケーションは、以下の技術・ライブラリを使用して構築されており、単一のHTMLファイルとして動作するようにバンドルされています。

* **Core**: HTML5, CSS3, JavaScript (ES6+)
* **Styling**: [Tailwind CSS](https://tailwindcss.com/) (CDN)
* **Icons**: [Lucide Icons](https://lucide.dev/)
* **Fonts**: Google Fonts (Noto Sans JP, Teko)
* **Drawing**: HTML5 Canvas API (`WillReadFrequently` 最適化済み)

## 🧩 アルゴリズムの詳細

### 色空間変換とマッチング

RGB色空間での単純な距離計算ではなく、以下の手順でマッチングを行っています。

1. **RGB → XYZ → CIELAB**: すべての画像の色情報を、人間の知覚に近いCIELAB色空間へ変換。
2. **Delta E 計算**: タイル画像とターゲット領域の色の差（距離）を計算。
3. **ペナルティ加算**:
* **使用回数ペナルティ**: 同じタイルが何度も使われるとスコアを下げ、多様なタイルの使用を促進。
* **近傍ペナルティ**: 隣接するセル（上、左、左上、右上）と同じ画像が配置されないように強力な補正を実施。



### パフォーマンス最適化

* **非同期処理**: メインスレッドをブロックしないよう、処理をバッチ分割し `requestAnimationFrame` や `setTimeout` を挟みながら処理を実行します。
* **メモリ管理**: タイル画像の解析時、サムネイル生成後に元画像（Blob）の参照を即座に破棄し、ブラウザのメモリ使用量を抑制しています。
* **Canvas最適化**: 画像のエクスポート時に `toBlob` を使用し、巨大な画像の生成でもクラッシュしにくい実装になっています。

## 📦 インストールと実行

特別なビルド手順やインストールは不要です。

1. `index.html` をダウンロードします。
2. Chrome, Edge, Safari, Firefox などのモダンブラウザでファイルを開いてください。

## ⚠️ 注意事項

* **ブラウザのメモリ制限**: 数千枚以上の高解像度画像を一度に読み込ませたり、「高画質」設定で巨大な画像を生成しようとすると、ブラウザのメモリ制限により動作が重くなる、またはクラッシュする可能性があります。
* **ローカル動作**: インターネット接続は CDN (Tailwind CSS, Google Fonts, Lucide) の読み込みにのみ使用されます。完全オフラインで使用する場合は、これらのリソースをローカルにダウンロードし、パスを書き換える必要があります。

## ライセンス

[MIT License](https://opensource.org/licenses/MIT)